<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3. Translation of OSM to Simple Features • osmdata</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="3. Translation of OSM to Simple Features">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">osmdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.5.025</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../articles/osmdata.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/osmdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>3. Translation of OSM to Simple Features</h1>
                        <h4 data-toc-skip class="author">Mark
Padgham</h4>
            
            <h4 data-toc-skip class="date">2024-10-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/osmdata/blob/master/vignettes/osm-sf-translation.Rmd" class="external-link"><code>vignettes/osm-sf-translation.Rmd</code></a></small>
      <div class="d-none name"><code>osm-sf-translation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="openstreetmap-data-structure">1. OpenStreetMap Data Structure<a class="anchor" aria-label="anchor" href="#openstreetmap-data-structure"></a>
</h2>
<p><a href="https://www.openstreetmap.org/" class="external-link">OpenStreetMap (OSM)</a> data
has a unique structure that is not directly reconcilable with other
modes of representing spatial data, notably including the widely-adopted
<a href="https://www.ogc.org/standard/sfa/" class="external-link">Simple Features (SF)</a>
scheme of the <a href="https://www.ogc.org" class="external-link">Open Geospatial Consortium
(OGC)</a>. The three primary spatial objects of OSM are:</p>
<ol style="list-style-type: decimal">
<li><p><code>nodes</code>, which are directly translatable to spatial
points</p></li>
<li><p><code>ways</code>, which may be closed, in which case they form
polygons, or unclosed, in which case they are (non-polygonal)
lines.</p></li>
<li>
<p><code>relations</code> which are higher-level objects used to
specify relationships between collections of ways and nodes. While there
are several recognised categories of <code>relations</code>, in spatial
terms these may be reduced to a binary distinction between:</p>
<ul>
<li><p><code>multipolygon</code> relations, which specify relationships
between an exterior polygon (through designating
<code>role='outer'</code>) and possible inner polygons
(<code>role='inner'</code>). These may or may not be designated with
<code>type=multipolygon</code>. Political boundaries, for example, often
have <code>type=boundary</code> rather than explicit
<code>type-multipolygon</code>. <code>osmdata</code> identifies
multipolygons as those <code>relation</code> objects having at least one
member with <code>role=outer</code> or <code>role=inner</code>.</p></li>
<li><p>In the absence of <code>inner</code> and <code>outer</code>
roles, an OSM relation is assumed to be non-polygonal, and to instead
form a collection of non-enclosing lines.</p></li>
</ul>
</li>
</ol>
<hr>
</div>
<div class="section level2">
<h2 id="simple-features-data-structure">2. Simple Features Data Structure<a class="anchor" aria-label="anchor" href="#simple-features-data-structure"></a>
</h2>
<p>The representation of spatial objects as Simple Features is <a href="https://www.ogc.org/standard/sfo/" class="external-link">described at length by the
OGC</a>, with this document merely reviewing relevant aspects. The SF
system assumes that spatial features can be represented in one of seven
distinct primary classes, which by convention are referred to in all
capital letters. Relevant classes for OSM data are:</p>
<ol style="list-style-type: decimal">
<li>POINT</li>
<li>MULTIPOINT</li>
<li>LINESTRING</li>
<li>MULTILINESTRING</li>
<li>POLYGON</li>
<li>MULTIPOLYGON</li>
</ol>
<p>(The seventh primary class is <code>GEOMETRYCOLLECTION</code>, which
contains several objects with different geometries.) An SF (where that
acronym may connote both singular and plural) consists of a sequence of
spatial coordinates, which for OSM data are only ever <code>XY</code>
coordinates represented as strings enclosed within brackets. In addition
to coordinate data and associated coordinate reference systems, an SF
may include any number of additional data which quantify or qualify the
feature of interest. In the <a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code> extension
to <code>R</code></a>, for example, a single SF is represented by one
row of a <code>data.frame</code>, with the geometry stored in a single
column, and any number of other columns containing these additional
data.</p>
<p>Simple Feature geometries are referred to in this vignette using all
capital letters (such as <code>POLYGON</code>), while OSM geometries use
lower case (such as <code>polygon</code>). Similarly, the Simple
Features standard of the OGC is referred to as <code>SF</code>, while
the <code>R</code> package of the same name is referred to as
<code>R::sf</code>–upper case <code>R</code> followed by lower case
<code>sf</code>. Much functionality of <code>R::sf</code> is determined
by the underlying <a href="https://gdal.org" class="external-link">Geospatial Data Abstraction
Library</a> (<code>GDAL</code>; described below). Representations of
data are often discussed here with reference to <code>GDAL/sf</code>, in
which case it may always be assumed that the translation and
representation of data are determined by <code>GDAL</code> and not
directly by the creators of <code>R::sf</code>.</p>
<hr>
</div>
<div class="section level2">
<h2 id="how-osmdata-translates-osm-into-simple-features">3. How <code>osmdata</code> translates OSM into Simple Features<a class="anchor" aria-label="anchor" href="#how-osmdata-translates-osm-into-simple-features"></a>
</h2>
<div class="section level3">
<h3 id="osm-nodes">3.1. OSM Nodes<a class="anchor" aria-label="anchor" href="#osm-nodes"></a>
</h3>
<p>OSM nodes translate directly into <code>SF::POINT</code> objects,
with all OSM <code>key-value</code> pairs stored in additional
<code>data.frame</code> columns.</p>
</div>
<div class="section level3">
<h3 id="osm-ways">3.2. OSM Ways<a class="anchor" aria-label="anchor" href="#osm-ways"></a>
</h3>
<p>OSM ways may be either polygons or (non-polygonal) lines.
<code>osmdata</code> translates these into <code>SF::LINESTRING</code>
and <code>SF::POLYGON</code> objects, respectively. Although polygonal
and non-polygonal ways may have systematically different
<code>key</code> fields, they are conflated here to the single set of
<code>key</code> values common to all <code>way</code> objects
regardless of shape. This enables direct comparison and uniform
operation on both <code>SF::LINESTRING</code> and
<code>SF::POLYGON</code> objects.</p>
</div>
<div class="section level3">
<h3 id="osm-relations">3.3 OSM Relations<a class="anchor" aria-label="anchor" href="#osm-relations"></a>
</h3>
<p>OSM relations comprising members with <code>role=outer</code> or
<code>role=inner</code> are translated into
<code>SF::MULTIPOLYGON</code> objects; otherwise they form
<code>SF::MULTILINESTRING</code> objects. As in the preceding case of
OSM ways, potentially systematic differences between OSM
<code>key</code> fields for <code>multipolygon</code> and other
<code>relation</code> objects are ignored in favour of returning
identical <code>key</code> fields in both cases, whether or not
<code>value</code> fields for those <code>key</code>s exist.</p>
<div class="section level4">
<h4 id="a-multipolygon-relations">3.3(a) Multipolygon Relations<a class="anchor" aria-label="anchor" href="#a-multipolygon-relations"></a>
</h4>
<p>An OSM multipolygon is translated by <code>osmdata</code> into a
single <code>SF::MULTIPOLYGON</code> object which has an additional
column specifying <code>num_members</code>. The <code>SF</code> geometry
thus consists of a list (an <code>R::List</code> object) of this number
of polygons, the first of which is the <code>outer</code> polygon, with
all subsequent members forming closed inner rings (either individually
or in combination).</p>
<p>Each of these inner polygons are also represented as one or more OSM
objects, which will generally include detailed data on the individual
components <strong>not</strong> able to be represented in the single
multipolygon representation. Each inner polygon is therefore
additionally stored in the <code>sf::MULTIPOLYGON</code>
<code>data.frame</code> along with all associated data. Thus the row
containing a multipolygon of <code>num_polygon</code> polygons is
followed by <code>num_polygon - 1</code> rows containing the data for
each <code>inner</code> polygon.</p>
<p>Note that OSM <code>relation</code> objects generally have fewer (or
different) <code>key-value</code> pairs than do OSM <code>way</code>
objects. In the OSM system, data describing the detailed properties of
the constituent ways of a given OSM relation are stored with those
<code>ways</code> rather than with the <code>relation</code>.
<code>osmdata</code> follows this general principle, and stored the
geometry of all <code>ways</code> of a <code>relation</code> with the
relation itself (that is, as part of the <code>MULTIPOLYGON</code> or
<code>MULTILINESTRING</code> object), while those ways are also stored
themselves as <code>LINESTRING</code> (or potentially
<code>POLYGON</code>) objects, from where their additional
<code>key-value</code> data may be accessed.</p>
</div>
<div class="section level4">
<h4 id="b-multilinestring-relations">3.3(b) Multilinestring Relations<a class="anchor" aria-label="anchor" href="#b-multilinestring-relations"></a>
</h4>
<p>OSM <code>relations</code> that are not <code>multipolygons</code>
are translated into <code>SF::MULTILINESTRING</code> objects. Each
member of any OSM relation is attributed a <code>role</code>, which may
be empty. <code>osmdata</code> collates all ways within a relation
according to their <code>role</code> attributes. Thus, unlike
multipolygon relations which are always translated into a single
<code>sf::MULTIPOLYGON</code> object, multilinestring relations are
translated by <code>omsdata</code> into potentially several
<code>sf::MULTILINESTRING</code> objects, one for each unique role.</p>
<p>This is particularly useful because <code>relations</code> are often
used to designated extended <code>highways</code> (for example,
designated bicycle routes or motorways), yet these often exist in
<code>primary</code> and <code>alternative</code> forms, with these
categories specified in roles. Separating these roles enables ready
access to any desired role.</p>
<p>These multilinestring objects also have a column specifying
<code>num_members</code>, as for multipolygons, with the primary member
followed by <code>num_members</code> rows, one for each member of the
multilinestring.</p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="gdal-translation-of-osm-into-simple-features">4. <code>GDAL</code> Translation of OSM into Simple Features<a class="anchor" aria-label="anchor" href="#gdal-translation-of-osm-into-simple-features"></a>
</h2>
<p>The <code>R</code> package <a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a> provide
an <code>R</code> implementation of Spatial Features, and provides a
wrapper around GDAL for reading geospatial data. <code>GDAL</code>
provides a <a href="https://gdal.org/drv_osm.html" class="external-link">‘driver’ to read OSM
data</a>, and thus <code>sf</code> can also be used to read
<code>OSM</code> data in <code>R</code>, <a href="https://docs.ropensci.org/osmdata/articles/osmdata.html">as
detailed in the main <code>osmdata</code> vignette</a>. However, the
<code>GDAL</code> translation of OSM data differs in several important
ways from the <code>osmdata</code> translation.</p>
<p>The primary difference is that GDAL only returns <em>unique</em>
objects of each spatial (SF) type. Thus <code>sf::POINT</code> objects
consist of only those points that are not otherwise members of some
‘higher’ object (<code>line</code>, <code>polygon</code>, or
<code>relation</code> objects). Although a given set of OSM data may
actually contain a great many points, attempting to load these with</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span> <span class="op">(</span><span class="va">file</span>, layer <span class="op">=</span> <span class="st">'points'</span><span class="op">)</span></span></code></pre></div>
<p>will generally return surprisingly few points.</p>
<div class="section level3">
<h3 id="osm-nodes-1">4.1. OSM Nodes<a class="anchor" aria-label="anchor" href="#osm-nodes-1"></a>
</h3>
<p>Apart from the numerical difference arising through
<code>osmdata</code> returning an <code>sf::POINTS</code> structure
containing <strong>all</strong> nodes within a given set of OSM data,
while <code>sf::st_read (file, layer='points')</code> returns only those
points not represented in other structure, the representation of points
remains otherwise broadly similar. The only other major difference is
that <code>osmdata</code> retains all <code>key-value</code> pairs
present in a given set of OSM data, whereas <code>GDAL/sf</code> only
retains a select few of these. Moreover, the <code>keys</code> returned
by <code>GDAL/sf</code> are pre-defined and invariant, meaning that data
returned from <code>sf::st_read (...)</code> may often contain
<code>key</code> columns in the resultant <code>data.frame</code> which
contain no (non-<code>NA</code>) data. This difference is illustrated in
an example repeated here from the<br><a href="https://docs.ropensci.org/osmdata/articles/osmdata.html">main
<code>osmdata</code> vignette</a>, with the same principles applying to
all of the following classes of OSM data.</p>
<p>The following three lines define a query and download the resultant
data to an <code>XML</code> file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span> <span class="op">(</span>bbox <span class="op">=</span> <span class="st">'Trentham, Australia'</span><span class="op">)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span> <span class="op">(</span><span class="va">q</span>, key <span class="op">=</span> <span class="st">'name'</span><span class="op">)</span> <span class="co"># any named objects</span></span>
<span><span class="fu"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span> <span class="op">(</span><span class="va">q</span>, <span class="st">'trentham.osm'</span><span class="op">)</span></span></code></pre></div>
<p>These data may then be converted into SF representations using either
<code>R::sf</code> or <code>osmdata</code>, with OSM <code>keys</code>
being the column names of the resultant <code>data.frame</code>
objects.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span> <span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span> <span class="op">(</span><span class="st">'trentham.osm'</span>, layer <span class="op">=</span> <span class="st">'points'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "osm_id"     "name"       "barrier"    "highway"    "ref"       </span></span>
<span><span class="co">##  [6] "address"    "is_in"      "place"      "man_made"   "other_tags"</span></span>
<span><span class="co">## [11] "geometry"</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span> <span class="op">(</span><span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> <span class="op">(</span><span class="va">q</span>, <span class="st">'trentham.osm'</span><span class="op">)</span><span class="op">$</span><span class="va">osm_points</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "osm_id"           "name"             "X_description_"   "X_waypoint_"     </span></span>
<span><span class="co">##  [5] "addr.city"        "addr.housenumber" "addr.postcode"    "addr.street"     </span></span>
<span><span class="co">##  [9] "amenity"          "barrier"          "denomination"     "foot"            </span></span>
<span><span class="co">## [13] "ford"             "highway"          "leisure"          "note_1"          </span></span>
<span><span class="co">## [17] "phone"            "place"            "railway"          "railway.historic"</span></span>
<span><span class="co">## [21] "ref"              "religion"         "shop"             "source"          </span></span>
<span><span class="co">## [25] "tourism"          "waterway"         "geometry"</span></span></code></pre>
<p><code>osmdata</code> returns far more <code>key</code> fields than
does <code>GDAL/sf</code>. More importantly, however,
<code>GDAL/sf</code> returns pre-defined <code>key</code> fields
regardless of whether they contain any data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">addr</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span> <span class="op">(</span><span class="st">'trentham.osm'</span>, layer <span class="op">=</span> <span class="st">'points'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">address</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span> <span class="op">(</span><span class="va">addr</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>In contrast, <code>osmdata</code> returns only those <code>key</code>
fields which contain data (and so excludes <code>address</code> in the
above example).</p>
</div>
<div class="section level3">
<h3 id="osm-ways-1">4.2. OSM Ways<a class="anchor" aria-label="anchor" href="#osm-ways-1"></a>
</h3>
<p>As for points, <code>GDAL/sf</code> only returns those ways that are
not represented or contained in ‘higher’ objects (OSM relations
interpreted as <code>SF::MULTIPOLYGON</code> or
<code>SF::MULTILINESTRING</code> objects). <code>osmdata</code> returns
all ways, and thus enables, for example, examination of the full
attributes of any member of a multigeometry object. This is not possible
with the <code>GDAL/sf</code> translation. As for points, the only
additional difference between <code>osmdata</code> and
<code>GDAL/sf</code> is that <code>osmdata</code> retains all
<code>key-value</code> pairs, whereas <code>GDAL</code> retains only a
select few.</p>
</div>
<div class="section level3">
<h3 id="osm-relations-1">4.3 OSM Relations<a class="anchor" aria-label="anchor" href="#osm-relations-1"></a>
</h3>
<p>Translation of OSM relations into Simple Features differs more
significantly between <code>osmdata</code> and <code>GDAL/sf</code>.</p>
<div class="section level4">
<h4 id="a-multipolygon-relations-1">4.3(a) Multipolygon Relations<a class="anchor" aria-label="anchor" href="#a-multipolygon-relations-1"></a>
</h4>
<p>As indicated above, multipolygon relations are translated in broadly
comparable ways by both <code>osmdata</code> and <code>sf/GDAL</code>.
Note, however, the <code>way</code> members of an OSM relation may be
specified in arbitrary order, and the multipolygonal way may not
necessarily be traced through simply following the segments in the order
returned by <code>sf/GDAL</code>.</p>
</div>
<div class="section level4">
<h4 id="b-multilinestring-relations-1">4.3(b) Multilinestring Relations<a class="anchor" aria-label="anchor" href="#b-multilinestring-relations-1"></a>
</h4>
<p>Linestring relations are simply read by GDAL directly in terms of the
their constituent ways, resulting in a single
<code>SF::MULTILINESTRING</code> object that contains exactly the same
number of lines as the ways in the OSM relation, regardless of their
<code>role</code> attributes. Note that <code>roles</code> are
frequently used to specify <code>alternative</code> multi-way routes
through a single OSM relation. Such distinctions between primary and
alternative are erased with <code>GDAL/sf</code> reading.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="examples">5 Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="routing">5.1 Routing<a class="anchor" aria-label="anchor" href="#routing"></a>
</h3>
<p>Navigable paths, routes, and ways are all tagged within OSM as
<code>highway</code>, readily enabling an <code>overpass</code> query to
return only <code>ways</code> that can be used for routing purposes.
Routes are nevertheless commonly assembled within OSM relations,
particularly where they form major, designated transport ways such as
long-distance foot or bicycle paths or major motorways.</p>
<div class="section level4">
<h4 id="a-routing-with-sfgdal">5.1(a) Routing with <code>sf/GDAL</code><a class="anchor" aria-label="anchor" href="#a-routing-with-sfgdal"></a>
</h4>
<p>A query for <code>key=highway</code> translated through
<code>GDAL/sf</code> will return those ways not part of any ‘higher’
structure as <code>SF::LINESTRING</code> objects, but components of an
entire transport network might also be returned as:</p>
<ol style="list-style-type: decimal">
<li>
<code>SF::MULTIPOLYGON</code> objects, holding all single ways which
form simple polygons (that is, in which start and end points are the
same);</li>
<li>
<code>SF::MULTIPOLYGON</code> objects holding all single
(non-polygonal) ways which combine to form an
<code>OSM multipolygon</code> relation (that is, in which the collection
of ways ultimately forms a closed <code>role=outer</code> polygon).</li>
<li>
<code>SF::MULTILINESTRING</code> objects holding all single
(non-polygonal) ways which combine to form an OSM relation that is not a
multipolygon.</li>
</ol>
<p>Translating these data into a single form usable for routing purposes
is not simple. A particular problem that is extremely difficult to
resolve is reconciling the <code>SF::MULTIPOLYGON</code> objects with
the geometry of the <code>SF::LINESTRING</code> objects. Highway
components contained in <code>SF::MULTIPOLYGON</code> objects need to be
re-connected with the network represented by the
<code>SF::LINESTRING</code> objects, yet the OSM identifiers of the
<code>MULTIPOLYGON</code> components are removed by
<code>sf/GDAL</code>, preventing these components from being directly
re-connected. The only way to ensure connection would be to re-connect
those geographic points sharing identical coordinates. This would
require code too long and complicated to be worthwhile demonstrating
here.</p>
</div>
<div class="section level4">
<h4 id="b-routing-with-osmdata">5.1(b) Routing with <code>osmdata</code><a class="anchor" aria-label="anchor" href="#b-routing-with-osmdata"></a>
</h4>
<p><code>osmdata</code> retains all of the underlying ways of ‘higher’
structures (<code>SF::MULTIPOLYGON</code> or
<code>SF::MULTILINESTRING</code> objects) as <code>SF::LINESTRING</code>
or <code>SF::POLYGON</code> objects. The geometries of the latter
objects duplicate those of the ‘higher’ relations, yet contain
additional <code>key-value</code> pairs corresponding to each way. Most
importantly, the OSM ID values for all members of a
<code>relation</code> are stored within that relation, readily enabling
the individual ways (<code>LINESTRING</code> or <code>POLYGON</code>
objects) to be identified from the <code>relation</code>
(<code>MULTIPOLYGON</code> or <code>MULTILINESTRING</code> object).</p>
<p>The <code>osmdata</code> translation thus readily enables a
singularly complete network to be reconstructed by simply combining the
<code>SF::LINESTRING</code> layer with the <code>SF::POLYGON</code>
layer. These layers will always contain entirely independent members,
and so will always be able to be directly combined without duplicating
any objects.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
