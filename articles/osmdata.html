<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1. osmdata • osmdata</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="1. osmdata">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">osmdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.5.025</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="active nav-item"><a class="nav-link" href="../articles/osmdata.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/osmdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>1. osmdata</h1>
                        <h4 data-toc-skip class="author">Mark
Padgham</h4>
                        <h4 data-toc-skip class="author">Robin
Lovelace</h4>
            
            <h4 data-toc-skip class="date">2024-10-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/osmdata/blob/master/vignettes/osmdata.Rmd" class="external-link"><code>vignettes/osmdata.Rmd</code></a></small>
      <div class="d-none name"><code>osmdata.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>osmdata</code> is an R package for downloading and using data
from OpenStreetMap (<a href="https://www.openstreetmap.org/" class="external-link">OSM</a>).
OSM is a global open access mapping project, which is free and open
under the <a href="https://www.openstreetmap.org/copyright" class="external-link">ODbL
licence</a> <span class="citation">(OpenStreetMap contributors
2017)</span>. This has many benefits, ensuring transparent data
provenance and ownership, enabling real-time evolution of the database
and, by allowing anyone to contribute, encouraging democratic decision
making and citizen science <span class="citation">(Johnson 2017)</span>.
See the <a href="https://wiki.openstreetmap.org/wiki/Contribute_map_data" class="external-link">OSM
wiki</a> to find out how to contribute to the world’s open geographical
data commons.</p>
<p>Unlike the <a href="https://cran.r-project.org/package=OpenStreetMap" class="external-link"><code>OpenStreetMap</code></a>
package, which facilitates the download of raster tiles,
<code>osmdata</code> provides access to the vector data underlying
OSM.</p>
<p><code>osmdata</code> can be installed from CRAN with</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"osmdata"</span><span class="op">)</span></span></code></pre></div>
<p>and then loaded in the usual way:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmdata/">osmdata</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Data (c) OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright</span></span></code></pre>
<p>The development version of <code>osmdata</code> can be installed with
the <code>remotes</code> package using the following command:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'ropensci/osmdata'</span><span class="op">)</span></span></code></pre></div>
<p><code>osmdata</code> uses the <a href="https://overpass-api.de" class="external-link"><code>overpass</code> API</a> to
download</p>
<p>OpenStreetMap (OSM) data and can convert the results to a variety of
formats, including both Simple Features (typically of class
<code>sf</code>) and Spatial objects
(e.g. <code>SpatialPointsDataFrame</code>), as defined by the packages
<a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a> and
<a href="https://cran.r-project.org/package=sp" class="external-link"><code>sp</code></a>
packages respectively.</p>
<p><code>overpass</code> is a C++ library that serves OSM data over the
web. All <code>overpass</code> queries begin with a bounding box,
defined in <code>osmdata</code> with the function
<code><a href="../reference/opq.html">opq()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">51.1</span>, <span class="fl">0.1</span>, <span class="fl">51.2</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The following sub-section provides more detail on bounding boxes.
Following the initial <code><a href="../reference/opq.html">opq()</a></code> call, <code>osmdata</code>
queries are built by adding one or more ‘features’, which are specified
in terms of <code>key-value</code> pairs. For example, all paths, ways,
and roads are designated in OSM with <code>key=highway</code>, so that a
query all motorways in greater London (UK) can be constructed as
follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'greater london uk'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'highway'</span>, value <span class="op">=</span> <span class="st">'motorway'</span><span class="op">)</span></span></code></pre></div>
<p>A detailed description of features is provided at the <a href="https://wiki.openstreetmap.org/wiki/Map_Features" class="external-link">OSM wiki</a>, or
the <code>osmdata</code> function <code><a href="../reference/available_features.html">available_features()</a></code> can
be used to retrieve the comprehensive list of feature keys currently
used in OSM.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span> <span class="op">(</span><span class="fu"><a href="../reference/available_features.html">available_features</a></span> <span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "4wd only"  "abandoned" "abutters"  "access"    "addr"      "addr:city"</span></span></code></pre>
<p>There are two primary <code>osmdata</code> functions for obtaining
data from a query: <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> and
<code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code>, which return data in <a href="https://cran.r-project.org/package=sf" class="external-link">Simple Features
(<code>sf</code>)</a> and <a href="https://cran.r-project.org/package=sp" class="external-link">Spatial
(<code>sp</code>)</a> formats, respectively. The typical workflow for
extracting OSM data with <code>osmdata</code> thus consists of the three
lines:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'greater london uk'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'highway'</span>, value <span class="op">=</span> <span class="st">'motorway'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The return object (<code>x</code>) is described in the third section
below.</p>
<div class="section level3">
<h3 id="bounding-boxes-the-getbb-function">1.1 Bounding boxes: the <code>getbb()</code> function<a class="anchor" aria-label="anchor" href="#bounding-boxes-the-getbb-function"></a>
</h3>
<p>While bounding boxes may be explicitly specified for the
<code><a href="../reference/opq.html">opq()</a></code> function, they are more commonly obtained from the
<code><a href="../reference/getbb.html">getbb()</a></code> function, which accepts character strings. As
illustrated in the above example, the <code><a href="../reference/opq.html">opq()</a></code> function also
accepts character strings, which are simply passed directly to
<code><a href="../reference/getbb.html">getbb()</a></code> to convert them to rectangular bounding boxes.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getbb.html">getbb</a></span><span class="op">(</span><span class="st">'Greater London, U.K.'</span><span class="op">)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bb</span><span class="op">)</span></span></code></pre></div>
<p>Note that the text string is not case sensitive, as illustrated in
the following code:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">q</span>, <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'greater london uk'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## TRUE</span></span></code></pre></div>
<p>Note also that <code><a href="../reference/getbb.html">getbb()</a></code> can return a data frame reporting
multiple matches or matrices representing bounding polygons of
matches:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getbb.html">getbb</a></span><span class="op">(</span>place_name <span class="op">=</span> <span class="st">"london"</span>, format_out <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span><span class="va">bb_poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getbb.html">getbb</a></span><span class="op">(</span>place_name <span class="op">=</span> <span class="st">"london"</span>, format_out <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span></span></code></pre></div>
<p>The <a href="https://www.overpass-api.de" class="external-link"><code>overpass API</code></a> only
accepts simple rectangular bounding boxes, and so data requested with a
bounding polygon will actually be all data within the corresponding
rectangular bounding box, but such data may be subsequently trimmed to
within the polygon with the <code><a href="../reference/trim_osmdata.html">trim_osmdata()</a></code> function,
demonstrated in the code immediately below.</p>
<p>All highways from within the polygonal boundary of Greater London can
be extracted with,</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getbb.html">getbb</a></span> <span class="op">(</span><span class="st">'london uk'</span>, format_out <span class="op">=</span> <span class="st">'polygon'</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bb</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'highway'</span>, value <span class="op">=</span> <span class="st">'motorway'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> <span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/trim_osmdata.html">trim_osmdata</a></span> <span class="op">(</span><span class="va">bb</span><span class="op">)</span></span></code></pre></div>
<p>See <code>?trim_osmdata()</code> for further ways to obtain
polygonally bounded sets of OSM data.</p>
<p>The <code><a href="../reference/getbb.html">getbb()</a></code> function also allows specification of an
explicit <code>featuretype</code>, such as street, city, county, state,
or country. The default value of <code>settlement</code> combines all
results below country and above streets. See <code><a href="../reference/getbb.html">?getbb</a></code> for
more details.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-overpass-api">2. The overpass API<a class="anchor" aria-label="anchor" href="#the-overpass-api"></a>
</h2>
<p>As mentioned, <code>osmdata</code> obtains OSM data from the <a href="https://www.overpass-api.de" class="external-link"><code>overpass API</code></a>, <a href="https://wiki.openstreetmap.org/wiki/Overpass_API" class="external-link">which is</a></p>
<blockquote>
<p>a read-only API that serves up custom selected parts of the OSM map
data.</p>
</blockquote>
<p>The syntax of <code>overpass</code> queries is powerful yet hard to
learn. This section briefly introduces the structure of
<code>overpass</code> queries in order to help construct more efficient
and powerful queries. Those wanting to skip straight onto query
construction in <code>osmdata</code> may safely jump ahead to the <a href="#query-example">query example below</a>.</p>
<p><code>osmdata</code> simplifies queries so that OSM data can be
extracted with very little understanding of the <code>overpass</code>
query syntax, although it is still possible to submit arbitrarily
complex <code>overpass</code> queries via <code>osmdata</code>. An
excellent place to explore <code>overpass</code> queries specifically
and OSM data in general is the online interactive query builder at <a href="https://overpass-turbo.eu/" class="external-link">overpass-turbo</a>, which includes a
helpful corrector function for incorrectly formatted queries. Examples
of its functionality in action can be found on the <a href="https://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_API_by_Example" class="external-link">OpenStreetMap
wiki</a>, with full details of the <code>overpass</code> query language
given in the <a href="https://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_QL" class="external-link">Query
Language Guide</a> as well as the <a href="https://wiki.openstreetmap.org/wiki/Overpass_API/Language_Guide" class="external-link">overpass
API Language Guide</a>.</p>
<p>By default, <code>osmdata</code> sends queries to one of the four
main <a href="https://wiki.openstreetmap.org/wiki/Overpass_API#Public_Overpass_API_instances" class="external-link"><code>overpass</code>
server instances</a>, such as
<code>https://overpass-api.de/api/interpreter</code> but other servers
listed on the page linked to above can be used, thanks to functions that
<em>get</em> and <em>set</em> the base url:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_overpass_url.html">get_overpass_url</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "https://overpass-api.de/api/interpreter"</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_url</span> <span class="op">&lt;-</span> <span class="st">"https://overpass.openstreetmap.ie/api/interpreter"</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_overpass_url.html">set_overpass_url</a></span><span class="op">(</span><span class="va">new_url</span><span class="op">)</span> <span class="co"># reset the base url (not run)</span></span></code></pre></div>
<p><code>osmdata</code> queries are lists of class
<code>overpass_query</code>. The actual query passed to the
<code>overpass API</code> with a query can be obtained with the function
<code><a href="../reference/opq_string.html">opq_string()</a></code>. Applied to the preceding query, this function
gives:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/opq_string.html">opq_string</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span></span>
<span><span class="co">## [out:xml][timeout:25];</span></span>
<span><span class="co">## (</span></span>
<span><span class="co">##   node</span></span>
<span><span class="co">##     ["highway"="motorway"]</span></span>
<span><span class="co">##     (51.2867602,-0.510375,51.6918741,0.3340155);</span></span>
<span><span class="co">##   way</span></span>
<span><span class="co">##     ["highway"="motorway"]</span></span>
<span><span class="co">##     (51.2867602,-0.510375,51.6918741,0.3340155);</span></span>
<span><span class="co">##   relation</span></span>
<span><span class="co">##     ["highway"="motorway"]</span></span>
<span><span class="co">##     (51.2867602,-0.510375,51.6918741,0.3340155);</span></span>
<span><span class="co">## );</span></span>
<span><span class="co">## (._;&gt;);out body;</span></span></code></pre></div>
<p>The resultant output may be pasted directly into the <a href="https://overpass-turbo.eu/" class="external-link">overpass-turbo</a> online interactive
query builder. (The output of <code>opq_string</code> has been somewhat
reformatted here to reflect the format typically used in
<code>overpass-turbo</code>.)</p>
<div class="section level3">
<h3 id="osmdata-queries">2.1. osmdata queries<a class="anchor" aria-label="anchor" href="#osmdata-queries"></a>
</h3>
<p>As demonstrated above, an <code>osmdata</code> query begins by
specifying a bounding box with the function <code><a href="../reference/opq.html">opq()</a></code>, followed
by specifying desired OSM features with
<code><a href="../reference/add_osm_feature.html">add_osm_feature()</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'Kunming, China'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'natural'</span>, value <span class="op">=</span> <span class="st">'water'</span><span class="op">)</span></span></code></pre></div>
<p>This query will request all natural water water bodies in Kunming,
China. A particular water body may be requested through appending a
further call to <code><a href="../reference/add_osm_feature.html">add_osm_feature()</a></code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'Kunming, China'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'natural'</span>, value <span class="op">=</span> <span class="st">'water'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'name:en'</span>, value <span class="op">=</span> <span class="st">'Dian'</span>, value_exact <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Each successive call to <code><a href="../reference/add_osm_feature.html">add_osm_feature()</a></code>
<strong>adds</strong> features to a query. This query is thus a request
for all bodies of natural water <strong>and</strong> those with English
names that include ‘Dian’. The requested data may be extracted through
calling one of the <code>osmdata_xml/sp/sf()</code> functions.</p>
<p>Single queries are always constructed through <strong>adding</strong>
features, and therefore correspond to logical <strong>AND</strong>
operations: natural water bodies <strong>AND</strong> those whose names
include ‘Dian’. The equivalent <strong>OR</strong> combination can be
extracted with the <a href="https://docs.ropensci.org/osmdata/reference/add_osm_features.html"><code>add_osm_features()</code>
function</a>. The following query represents the OR-equivalent of the
above query, requesting data on both all natural features with the value
of <code>"water"</code> OR all features whose English name is
<code>"Dian"</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'Kunming, China'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_features.html">add_osm_features</a></span><span class="op">(</span>features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="st">"\"natural\"=\"water\""</span>,</span>
<span>                                   <span class="st">"\"name:en\"=\"Dian\""</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that the <code>"="</code> symbols here requests features whose
values exactly match the given values. Other “filter” symbols are
possible, as described in the <a href="https://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_QL#By_tag_.28has-kv.29" class="external-link">overpass
query language definition</a>, including symbols for negation
(<code>!=</code>), or approximate matching (<code>~</code>).</p>
<p>Passing this query to <a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html"><code>osmdata_sf()</code></a>
will return identical data to the following way to explicitly construct
an OR query through using the inbuilt <code>c</code> operator of
<code>osmdata</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'Kunming, China'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'natural'</span>, value <span class="op">=</span> <span class="st">'water'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> <span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'Kunming, China'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'name:en'</span>, value <span class="op">=</span> <span class="st">'Dian'</span>, value_exact <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span> <span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span> <span class="op">(</span><span class="va">dat1</span>, <span class="va">dat2</span><span class="op">)</span></span></code></pre></div>
<p>While the “filter” symbols may be explicitly specified in <a href="https://docs.ropensci.org/osmdata/reference/add_osm_features.html">the
<code>add_osm_features()</code> function</a>, the single-feature version
of <a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html"><code>add_osm_feature()</code>
function</a> has several logical parameters to control matching without
needing to remember precise overpass syntax:</p>
<ul>
<li>
<code>key_exact</code> can be set to <code>FALSE</code> to
approximately match given keys;</li>
<li>
<code>value_exact</code> can be set to <code>FALSE</code> to
approximately match given values; and</li>
<li>
<code>match_case</code> can be set to <code>FALSE</code> to match
keys and values in both lower and upper case forms.</li>
</ul>
<p>The previous query with <code>key = 'name:end'</code> and
<code>value = 'Dian'</code> could thus be replaced by the following:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'name'</span>, value <span class="op">=</span> <span class="st">'dian'</span>,</span>
<span>                key_exact <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                value_exact <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                match_case <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-osm-data-from-a-query">2.2 Extracting <code>OSM</code> data from a query<a class="anchor" aria-label="anchor" href="#extracting-osm-data-from-a-query"></a>
</h3>
<p>The primary <code>osmdata</code> functions <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code>
or <code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code> pass these queries to <code>overpass</code>
and return OSM data in corresponding <code>sf</code> or <code>sp</code>
format, respectively. Both of these functions also accept direct
<code>overpass</code> queries, such as those produced by the
<code>osmdata</code> function <code><a href="../reference/opq_string.html">opq_string()</a></code>, or copied
directly from the <a href="https://overpass-turbo.eu" class="external-link"><code>overpass-turbo</code> query
builder</a>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="fu"><a href="../reference/opq_string.html">opq_string</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Object of class 'osmdata' with:</span></span>
<span><span class="co">##                  $bbox :</span></span>
<span><span class="co">##         $overpass_call : The call submitted to the overpass API</span></span>
<span><span class="co">##             $timestamp : [ Thurs 5 May 2017 14:33:54 ]</span></span>
<span><span class="co">##            $osm_points : 'sf' Simple Features Collection with 360582 points</span></span>
<span><span class="co">##            ...</span></span></code></pre></div>
<p>Note that the result contains no value for <code>bbox</code>, because
that information is lost when the full <code>osmdata_query</code>,
<code>q</code>, is converted to a string. Nevertheless, the results of
the two calls <code>osmdata_sf (opq_string (q))</code> and
<code>osmdata_sf (q)</code> differ only in the values of
<code>bbox</code> and <code>timestamp</code>, while returning otherwise
identical data.</p>
<p>In summary, <code>osmdata</code> queries are generally simplified
versions of potentially more complex <code>overpass</code> queries,
although arbitrarily complex <code>overpass</code> queries may be passed
directly to the primary <code>osmdata</code> functions. As illustrated
above, <code>osmdata</code> queries are generally constructed through
initiating a query with <code><a href="../reference/opq.html">opq()</a></code>, and then specifying OSM
features in terms of <code>key-value</code> pairs with
<code><a href="../reference/add_osm_feature.html">add_osm_feature()</a></code>, along with judicious usage of the
<code>key_exact</code>, <code>value_exact</code>, and
<code>match_case</code> parameters.</p>
<p>The simplest way to use <code>osmdata</code> is to simply request all
data within a given bounding box (warning - not intended to run):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'London City, U.K.'</span><span class="op">)</span></span>
<span><span class="va">lots_of_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span></span></code></pre></div>
<p>Queries are, however, usually more useful when refined through using
<code><a href="../reference/add_osm_feature.html">add_osm_feature()</a></code>, which minimally requires a single
<code>key</code> and returns all objects specifying any value for that
<code>key</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">not_so_much_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'city of london uk'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'highway'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'name'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><code>osmdata</code> will use that query to return all named highways
within the requested bounding box. Note that <code>key</code>
specifications are requests for features which must include those keys,
yet most features will also include many other keys, and thus
<code>osmdata</code> objects generally list a large number of distinct
keys, as demonstrated below.</p>
</div>
<div class="section level3">
<h3 id="query-example">2.3. Query example<a class="anchor" aria-label="anchor" href="#query-example"></a>
</h3>
<p>To appreciate query building in more concrete terms, let’s imagine
that we wanted to find all cycle paths in Seville, Spain:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span><span class="st">'Sevilla'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'highway'</span>, value <span class="op">=</span> <span class="st">'cycleway'</span><span class="op">)</span></span>
<span><span class="va">cway_sev</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span><span class="op">(</span><span class="va">q1</span><span class="op">)</span></span>
<span><span class="fu">sp</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">cway_sev</span><span class="op">$</span><span class="va">osm_lines</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://cloud.githubusercontent.com/assets/1825120/23708182/fba4ed96-040c-11e7-90cd-3274d394030a.png"></p>
<p>Now imagine we want to make a more specific query that only extracts
designated cycleways or those which are bridges. Combining these into
one query will return only those that are designated cycleways
<strong>AND</strong> that are bridges:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">des_bike</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q1</span><span class="op">)</span></span>
<span><span class="va">q2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span><span class="va">q1</span>, key <span class="op">=</span> <span class="st">'bridge'</span>, value <span class="op">=</span> <span class="st">'yes'</span><span class="op">)</span></span>
<span><span class="va">des_bike_and_bridge</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">des_bike_and_bridge</span><span class="op">$</span><span class="va">osm_points</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">des_bike_and_bridge</span><span class="op">$</span><span class="va">osm_lines</span><span class="op">)</span></span>
<span><span class="co">## [1] 99</span></span>
<span><span class="co">## [1] 32</span></span></code></pre></div>
<p>That query returns only 99 points and 32 lines. Designed cycleways
<strong>OR</strong> bridges can be obtained through simply combining
multiple <code>osmdata</code> objects with the <code>c</code>
operator:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span><span class="st">'Sevilla'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'bridge'</span>, value <span class="op">=</span> <span class="st">'yes'</span><span class="op">)</span></span>
<span><span class="va">bridge</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q2</span><span class="op">)</span></span>
<span><span class="va">des_bike_or_bridge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">des_bike</span>, <span class="va">bridge</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">des_bike_or_bridge</span><span class="op">$</span><span class="va">osm_points</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">des_bike_or_bridge</span><span class="op">$</span><span class="va">osm_lines</span><span class="op">)</span></span>
<span><span class="co">## [1] 9757</span></span>
<span><span class="co">## [1] 1061</span></span></code></pre></div>
<p>And as expected, the <code>OR</code> operation produces more data
than the equivalent <code>AND</code>, showing the utility of combining
<code>osmdata</code> objects with the generic function
<code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-osmdata-object">3. The <code>osmdata</code> object<a class="anchor" aria-label="anchor" href="#the-osmdata-object"></a>
</h2>
<p>The <code>osmdata</code> extraction functions
(<code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> and <code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code>), both return
objects of class <code>osmdata</code>. The structure of
<code>osmdata</code> objects are clear from their default print method,
illustrated using the <code>bridge</code> example from the previous
section:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bridge</span></span>
<span><span class="co">##  Object of class 'osmdata' with:</span></span>
<span><span class="co">##                   $bbox : 37.3002036,-6.0329182,37.4529579,-5.819157</span></span>
<span><span class="co">##          $overpass_call : The call submitted to the overpass API</span></span>
<span><span class="co">##              $timestamp : [ Thurs 5 May 2017 14:41:19 ]</span></span>
<span><span class="co">##             $osm_points : 'sf' Simple Features Collection with 69 points</span></span>
<span><span class="co">##              $osm_lines : 'sf' Simple Features Collection with 25 linestrings</span></span>
<span><span class="co">##           $osm_polygons : 'sf' Simple Features Collection with 0 polygons</span></span>
<span><span class="co">##         $osm_multilines : 'sf' Simple Features Collection with 0 multilinestrings</span></span>
<span><span class="co">##      $osm_multipolygons : 'sf' Simple Features Collection with 0 multipolygons</span></span></code></pre></div>
<p>As the results show, all <code>osmdata</code> objects should
contain:</p>
<ul>
<li>A bounding box (which can be accessed with
<code>bridge$bbox</code>)</li>
<li>A time-stamp of the query (<code>bridge$timestamp</code>, useful for
checking data is up-to-date)</li>
<li>The spatial data, consisting of <code>osm_points</code>,
<code>osm_lines</code>, <code>osm_polygons</code>,
<code>osm_multilines</code> and <code>osm_multipolygons</code>.</li>
</ul>
<p>Some or all of these can be empty: the example printed above contains
only points and lines. The more complex features of
<code>osm_multilines</code> and <code>osm_multipolygons</code> refer to
OSM relations than contain multiple lines and polygons.</p>
<p>The actual spatial data contained in an <code>osmdata</code> object
are of either <code>sp</code> format when extracted with
<code><a href="../reference/osmdata_sp.html">osmdata_sp()</a></code> or <code>sf</code> format when extracted with
<code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">$</span><span class="va">osm_lines</span><span class="op">)</span></span>
<span><span class="co">## [1] "sf"         "data.frame"</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span><span class="op">$</span><span class="va">osm_lines</span><span class="op">)</span></span>
<span><span class="co">## [1] "SpatialLinesDataFrame"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "sp"</span></span></code></pre></div>
<p>In addition to these two functions, <code>osmdata</code> provides a
third function, <code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code>, which allows raw OSM data to
be returned and optionally saved to disk in XML format. The following
code demonstrates this function, beginning with a new query.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.12</span>, <span class="fl">51.51</span>, <span class="op">-</span><span class="fl">0.11</span>, <span class="fl">51.52</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'building'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'buildings.osm'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">## [1] "xml_document" "xml_node"</span></span></code></pre></div>
<p>This call both returns the same data as the object <code>dat</code>
and saves them to the file <code>buildings.osm</code>. Downloaded XML
data can be converted to <code>sf</code> or <code>sp</code> formats by
simply passing the data to the respective <code>osmdata</code>
functions, either as the name of a file or an XML object:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.12</span>, <span class="fl">51.51</span>, <span class="op">-</span><span class="fl">0.11</span>, <span class="fl">51.52</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'building'</span><span class="op">)</span></span>
<span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span><span class="op">(</span><span class="va">q</span>, <span class="st">'buildings.osm'</span><span class="op">)</span></span>
<span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q</span>, <span class="va">doc</span><span class="op">)</span></span>
<span><span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q</span>, <span class="st">'buildings.osm'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">dat1</span>, <span class="va">dat2</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre></div>
<p>The following sub-sections now explore these three functions in more
detail, beginning with <code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code>.</p>
<div class="section level3">
<h3 id="the-osmdata_xml-function">3.1. The <code>osmdata_xml()</code> function<a class="anchor" aria-label="anchor" href="#the-osmdata_xml-function"></a>
</h3>
<p><code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code> returns OSM data in native XML format, and
also allows these data to be saved directly to disk (conventionally
using the file suffix <code>.osm</code>, although any suffix may be
used). The <code>XML</code> data are formatting using the <code>R</code>
package <code>xml2</code>, and may be processed within <code>R</code>
using any methods compatible with such data, or may be processed by any
other software able to load the <code>XML</code> data directly from
disk.</p>
<p>The first few lines of the XML data downloaded above look like
this:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">'buildings.osm'</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">## [1] "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;"</span></span>
<span><span class="co">## [2] "&lt;osm version=\"0.6\" generator=\"Overpass API\"&gt;"</span></span>
<span><span class="co">## [3] "  &lt;note&gt;The data included in this document is from www.openstreetmap.org. The data is made available under ODbL.&lt;/note&gt;"</span></span>
<span><span class="co">## [4] "  &lt;meta osm_base=\"2017-03-07T09:28:03Z\"/&gt;"</span></span>
<span><span class="co">## [5] "  &lt;node id=\"21593231\" lat=\"51.5149566\" lon=\"-0.1134203\"/&gt;"</span></span>
<span><span class="co">## [6] "  &lt;node id=\"25378129\" lat=\"51.5135870\" lon=\"-0.1115193\"/&gt;"</span></span></code></pre></div>
<p>These data can be used in any other programs able to read and process
XML data, such as the open source GIS <a href="https://qgis.org/en/site/" class="external-link">QGIS</a> or the OSM data editor <a href="https://wiki.openstreetmap.org/wiki/JOSM" class="external-link">JOSM</a>. The remainder
of this vignette assumes that not only do you want to get OSM data using
R, you also want to import and eventually process it, using R. For that
you’ll need to import the data into a native R class.</p>
<p>As demonstrated above, downloaded data can be directly processed by
passing either filenames or the <code>R</code> objects containing those
data to the <code>osmdata_sf/sp()</code> functions:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span><span class="op">(</span><span class="va">q</span>, <span class="st">'buildings.osm'</span><span class="op">)</span></span>
<span><span class="va">dat_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q</span>, <span class="st">'buildings.osm'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-osmdata_sf-function">3.2. The <code>osmdata_sf()</code> function<a class="anchor" aria-label="anchor" href="#the-osmdata_sf-function"></a>
</h3>
<p><code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> returns OSM data in <a href="https://www.ogc.org/standard/sfo/" class="external-link">Simple Features (SF)</a>
format, defined by the <a href="https://www.ogc.org" class="external-link">Open Geospatial
Consortium</a>, and implemented in the <code>R</code> package <a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a>. This
package provides a direct interface to the <code>C++</code> <a href="https://gdal.org" class="external-link">Graphical Data Abstraction Library (GDAL)</a>
which also includes a so-called <a href="https://gdal.org/drv_osm.html" class="external-link">‘driver’ for OSM data</a>. This
means that OSM data may also be read directly with <code>sf</code>,
rather than using <code>osmdata</code>. In this case, data must first be
saved to disk, which can be readily achieved using
<code><a href="../reference/osmdata_xml.html">osmdata_xml()</a></code> described above, or through downloading
directly from the <a href="https://overpass-turbo.eu" class="external-link">overpass
interactive query builder</a>.</p>
<p>The following example is based on this query:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'Trentham, Australia'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'name'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/osmdata_xml.html">osmdata_xml</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">'trentham.osm'</span><span class="op">)</span></span></code></pre></div>
<p><code>sf</code> can then read such data independent of
<code>osmdata</code> though:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">'trentham.osm'</span>, layer <span class="op">=</span> <span class="st">'points'</span><span class="op">)</span></span>
<span><span class="co">## Reading layer `points' from data source `trentham.osm' using driver `OSM'</span></span>
<span><span class="co">## Simple feature collection with 38 features and 10 fields</span></span>
<span><span class="co">## geometry type:  POINT</span></span>
<span><span class="co">## dimension:      XY</span></span>
<span><span class="co">## bbox:           xmin: 144.2894 ymin: -37.4846 xmax: 144.3893 ymax: -37.36012</span></span>
<span><span class="co">## epsg (SRID):    4326</span></span>
<span><span class="co">## proj4string:    +proj=longlat +datum=WGS84 +no_defs</span></span></code></pre></div>
<p>The <code>GDAL</code> drivers used by <code>sf</code> can only load
single ‘layers’ of features, for example, <code>points</code>,
<code>lines</code>, or <code>polygons</code>. In contrast,
<code>osmdata</code> loads all features simultaneously:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q</span>, <span class="st">'trentham.osm'</span><span class="op">)</span></span>
<span><span class="co">## Object of class 'osmdata' with:</span></span>
<span><span class="co">##                  $bbox : -37.4300874,144.2863388,-37.3500874,144.3663388</span></span>
<span><span class="co">##         $overpass_call : The call submitted to the overpass API</span></span>
<span><span class="co">##             $timestamp : [ Thus 5 May 2017 14:42:19 ]</span></span>
<span><span class="co">##            $osm_points : 'sf' Simple Features Collection with 7106 points</span></span>
<span><span class="co">##             $osm_lines : 'sf' Simple Features Collection with 263 linestrings</span></span>
<span><span class="co">##          $osm_polygons : 'sf' Simple Features Collection with 38 polygons</span></span>
<span><span class="co">##        $osm_multilines : 'sf' Simple Features Collection with 1 multilinestrings</span></span>
<span><span class="co">##     $osm_multipolygons : 'sf' Simple Features Collection with 6 multipolygons</span></span></code></pre></div>
<p>Even for spatial objects of the same type (the same ‘layers’ in
<code>sf</code> terminology), <code>osmdata</code> returns considerably
more objects–7,166 points compared .with just 38. The raw sizes of data
returned can be compared with:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q</span>, <span class="st">'trentham.osm'</span><span class="op">)</span><span class="op">$</span><span class="va">osm_points</span><span class="op">)</span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">'trentham.osm'</span>, layer <span class="op">=</span> <span class="st">'points'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">s1</span> <span class="op">/</span> <span class="va">s2</span><span class="op">)</span></span>
<span><span class="co">## [1] 511.4193</span></span></code></pre></div>
<p>And the <code>osmdata points</code> contain over 500 times as much
data. The primary difference between <code>sf/GDAL</code> and
<code>osmdata</code> is that the former returns only those objects
unique to each category of spatial object. Thus OSM nodes
(<code>points</code> in <code>sf/osmdata</code> representations)
include, in <code>sf/GDAL</code> representation, only those points which
are not part of any other objects (such as lines or polygons). In
contrast, the <code>osm_points</code> object returned by
<code>osmdata</code> includes all points regardless of whether or not
these are represented in other spatial objects. Similarly,
<code>line</code> objects in <code>sf/GDAL</code> exclude any lines that
are part of other objects such as <code>multipolygon</code> or
<code>multiline</code> objects.</p>
<p>This processing of data by <code>sf/GDAL</code> has two important
implications:</p>
<ol style="list-style-type: decimal">
<li><p>An implicit hierarchy of spatial objects is enforced through
including elements of objects only at their ‘highest’ level of
representation, where <code>multipolygon</code> and
<code>multiline</code> objects are assumed to be at ‘higher’ levels than
<code>polyon</code> or <code>line</code> objects, and these in turn are
at ‘higher’ levels than <code>point</code> objects. <code>osmdata</code>
makes no such hierarchical assumptions.</p></li>
<li><p>All OSM are structured by giving each object a unique identifier
so that the components of any given object (the nodes of a line, for
example, or the lines of a multipolygon) can be described simply by
giving these identifiers. This enables the components of any OSM object
to be examined in detail. The <code>sf/GDAL</code> representation
obviates this ability through removing these IDs and reducing everything
to geometries alone (which is, after all, why it is called
‘<em>Simple</em> Features’). This means, for example, that the
<code>key-value</code> pairs of the <code>line</code> or
<code>polygon</code> components of <code>multipolygon</code> can never
be extracted from an <code>sf/GDAL</code> representation. In contrast,
<code>osmdata</code> retains all unique identifiers for all OSM objects,
and so readily enables, for example, the properties of all
<code>point</code> objects of a <code>line</code> to be
extracted.</p></li>
</ol>
<p>Another reason why <code>osmdata</code> returns more data than
<code>GDAL/sf</code> is that the latter extracts only a restricted list
of OSM <code>keys</code>, whereas <code>osmdata</code> returns all
<code>key</code> fields present in the requested data:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">'trentham.osm'</span>, layer <span class="op">=</span> <span class="st">'points'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># the keys</span></span>
<span><span class="co">## [1] "osm_id"     "name"       "barrier"    "highway"</span></span>
<span><span class="co">## [5] "ref"        "address"    "is_in"      "place"</span></span>
<span><span class="co">## [9] "man_made"   "other_tags" "geometry"</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q</span>, <span class="st">'trentham.osm'</span><span class="op">)</span><span class="op">$</span><span class="va">osm_points</span><span class="op">)</span></span>
<span><span class="co">## [1] "osm_id"           "name"             "X_description_"   "X_waypoint_"</span></span>
<span><span class="co">## [5] "addr.city"        "addr.housenumber" "addr.postcode"    "addr.street"</span></span>
<span><span class="co">## [9] "amenity"          "barrier"          "denomination"     "foot"</span></span>
<span><span class="co">## [13] "ford"             "highway"          "leisure"          "note_1"</span></span>
<span><span class="co">## [17] "phone"            "place"            "railway"          "railway.historic"</span></span>
<span><span class="co">## [21] "ref"              "religion"         "shop"             "source"</span></span>
<span><span class="co">## [25] "tourism"          "waterway"         "geometry"</span></span></code></pre></div>
<p><code>key</code> fields which are not specified in a given set of OSM
data are not returned by <code>osmdata</code>, while
<code>GDAL/sf</code> returns the same <code>key</code> fields regardless
of whether any values are specified.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">addr</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">'trentham.osm'</span>, layer <span class="op">=</span> <span class="st">'points'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">address</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">addr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## TRUE</span></span></code></pre></div>
<p>and <code>key=address</code> contains no data yet is still returned
by <code>GDAL/sf</code>.</p>
<p>Finally, note that <code>osmdata</code> will generally extract OSM
data considerably faster than equivalent <code>sf/GDAL</code> routines
(as detailed <a href="https://github.com/ropensci/osmdata/wiki/Timing-benchmarks" class="external-link">here</a>).</p>
</div>
<div class="section level3">
<h3 id="the-osmdata_sp-function">3.3. The <code>osmdata_sp()</code> function<a class="anchor" aria-label="anchor" href="#the-osmdata_sp-function"></a>
</h3>
<p>As with <code><a href="../reference/osmdata_sf.html">osmdata_sf()</a></code> described above, OSM data may be
converted to <code>sp</code> format without using <code>osmdata</code>
via the <code>sf</code> functions demonstrated below:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">'buildings.osm'</span>, layer <span class="op">=</span> <span class="st">'multipolygons'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dat_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">dat</span>, <span class="st">'Spatial'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dat_sp</span><span class="op">)</span></span>
<span><span class="co">## [1] "SpatialPolygonsDataFrame"\nattr(,"package")\n[1] "sp"</span></span></code></pre></div>
<p>These data are extracted using the GDAL, and so suffer all of the
same shortcomings mentioned above. Note differences in the amount of
data returned:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dat_sp</span><span class="op">)</span></span>
<span><span class="co">## [1] 560  25</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span><span class="op">(</span><span class="va">q</span>, doc <span class="op">=</span> <span class="st">'buildings.osm'</span><span class="op">)</span><span class="op">$</span><span class="va">osm_polygons</span><span class="op">)</span></span>
<span><span class="co">## [1] 566 114</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span><span class="op">(</span><span class="va">q</span>, doc <span class="op">=</span> <span class="st">'buildings.osm'</span><span class="op">)</span><span class="op">$</span><span class="va">osm_multipolygons</span><span class="op">)</span></span>
<span><span class="co">## [1] 15 52</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="recursive-searching">4. Recursive searching<a class="anchor" aria-label="anchor" href="#recursive-searching"></a>
</h2>
<p>As described above, <code>osmdata</code> returns all data of each
type and so allows the components of any given spatial object to be
examined in their own right. This ability to extract, for example, all
points of a line, or all polygons which include a given set of points,
is referred to as <em>recursive searching</em>.</p>
<p>Recursive searching is not possible with <code>GDAL/sf</code>,
because OSM identifiers are removed, and only the unique data of each
type of object are retained. To understand both recursive searching and
why it is useful, note that OSM data are structured in three
hierarchical levels:</p>
<ol style="list-style-type: decimal">
<li><p><code>nodes</code> representing spatial points</p></li>
<li><p><code>ways</code> representing lines, both as
<code>polygons</code> (with connected ends) and non-polygonal
<code>lines</code></p></li>
<li><p><code>relations</code> representing more complex objects
generally comprising collections of <code>ways</code> and/or
<code>nodes</code>. Examples include <code>multipolygon relations</code>
comprising an outer polygon (which may itself be made of several
distinct <code>ways</code> which ultimately connect to form a single
circle), and several inner polygons.</p></li>
</ol>
<p>Recursive searching allows for objects within any one of these
hierarchical levels to be extracted based on components in any other
level. Recursive searching is performed in <code>osmdata</code> with the
following functions:</p>
<ol style="list-style-type: decimal">
<li><p><code><a href="../reference/osm_points.html">osm_points()</a></code>, which extracts all <code>point</code>
or <code>node</code> objects</p></li>
<li><p><code><a href="../reference/osm_lines.html">osm_lines()</a></code>, which extracts all <code>way</code>
objects that are <code>lines</code> (that are, that are not
<code>polygons</code>)</p></li>
<li><p><code><a href="../reference/osm_polygons.html">osm_polygons()</a></code>, which extracts all
<code>polygon</code> objects</p></li>
<li><p><code><a href="../reference/osm_multilines.html">osm_multilines()</a></code>, which extracts all
<code>multiline</code> objects; and</p></li>
<li><p><code><a href="../reference/osm_multipolygons.html">osm_multipolygons()</a></code>, which extracts all
<code>multipolygon</code> objects.</p></li>
</ol>
<p>Each of these functions accepts as an argument a vector of OSM
identifiers. To demonstrate these functions, we first re-create the
example above of named objects from Trentham, Australia:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="st">'Trentham, Australia'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">'name'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="example">4.1. Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Then imagine we are interested in the <code>osm_line</code> object
describing the ‘Coliban River’:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">tr</span><span class="op">$</span><span class="va">osm_lines</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">'Coliban River'</span><span class="op">)</span></span>
<span><span class="va">coliban</span> <span class="op">&lt;-</span> <span class="va">tr</span><span class="op">$</span><span class="va">osm_lines</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span><span class="va">coliban</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">coliban</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## Simple feature collection with 1 feature and 3 fields</span></span>
<span><span class="co">## geometry type:  LINESTRING</span></span>
<span><span class="co">## dimension:      XY</span></span>
<span><span class="co">## bbox:           xmin: 144.3235 ymin: -37.37162 xmax: 144.3335 ymax: 37.36366</span></span>
<span><span class="co">## epsg (SRID):    4326</span></span>
<span><span class="co">## proj4string:    +proj=longlat +datum=WGS84 +no_defs</span></span>
<span><span class="co">##            osm_id          name waterway                       geometry</span></span>
<span><span class="co">## 87104907 87104907 Coliban River    river LINESTRING(144.323471069336...</span></span></code></pre></div>
<p>The locations of the points of this line can be extracted directly
from the <code>sf</code> object with:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coliban</span><span class="op">$</span><span class="va">geometry</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## LINESTRING(144.323471069336 -37.3716201782227, 144.323944091797 -37.3714790344238, 144.324356079102 -37.3709754943848, 144.324493408203 -37.3704833984375, 144.324600219727 -37.370174407959, 144.324981689453 -37.3697204589844, 144.325149536133 -37.369441986084, 144.325393676758 -37.3690567016602, 144.325714111328 -37.3686943054199, 144.326080322266 -37.3682441711426)</span></span></code></pre></div>
<p>The output contains nothing other than geometries (because, to
reiterate, these are ‘<em>Simple</em> Features’), and no further
information regarding those points can be extracted. The Coliban River
has a waterfall in Trentham, and one of the <code>osm_points</code>
objects describes this waterfall. The information necessary to locate
this waterfall is removed from the <code>GDAL/sf</code> representation,
but can be extracted with <code>osmdata</code> with the following lines,
noting that the OSM ID of the line <code>coliban</code> is given by
<code>rownames(coliban)</code>.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osm_points.html">osm_points</a></span><span class="op">(</span><span class="va">tr</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">coliban</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="va">pts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">pts</span><span class="op">$</span><span class="va">waterway</span> <span class="op">==</span> <span class="st">'waterfall'</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">wf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">wf</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## Simple feature collection with 1 feature and 4 fields</span></span>
<span><span class="co">## geometry type:  POINT</span></span>
<span><span class="co">## dimension:      XY</span></span>
<span><span class="co">## bbox:           xmin: 144.3246 ymin: -37.37017 xmax: 144.3246 ymax: -37.37017</span></span>
<span><span class="co">## epsg (SRID):    4326</span></span>
<span><span class="co">## proj4string:    +proj=longlat +datum=WGS84 +no_defs</span></span>
<span><span class="co">##                osm_id           name    tourism  waterway</span></span>
<span><span class="co">## 1013064837 1013064837 Trentham Falls attraction waterfall</span></span>
<span><span class="co">##                                  geometry</span></span>
<span><span class="co">## 1013064837 POINT(144.324600219727 -37....</span></span></code></pre></div>
<p>This point could be used as the basis for further recursive searches.
For example, all <code>multipolygon</code> objects which include
Trentham Falls could be extracted with:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osm_multipolygons.html">osm_multipolygons</a></span><span class="op">(</span><span class="va">tr</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">wf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Although this returns no data in this case, it nevertheless
demonstrates the usefulness and ease of recursive searching with
<code>osmdata</code>.</p>
</div>
<div class="section level3">
<h3 id="relation-example">4.2 Relation example<a class="anchor" aria-label="anchor" href="#relation-example"></a>
</h3>
<p>A special type of OSM object is a relation. These can be defined by
their name, which can join many divers features into a single object.
The following example extracts the London Route Network Route 9, which
is composed of many (over 100) separate lines:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lcnr9</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/opq.html">opq</a></span> <span class="op">(</span><span class="st">'greater london uk'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_osm_feature.html">add_osm_feature</a></span> <span class="op">(</span>key <span class="op">=</span> <span class="st">"name"</span>, value <span class="op">=</span> <span class="st">"LCN 9"</span>,</span>
<span>                 value_exact <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/osmdata_sp.html">osmdata_sp</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">sp</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">lcnr9</span><span class="op">$</span><span class="va">osm_lines</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://cloud.githubusercontent.com/assets/1825120/23709879/c98e2c2c-0412-11e7-86b8-1ffc95aab5a1.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="additional-functionality">5. Additional Functionality<a class="anchor" aria-label="anchor" href="#additional-functionality"></a>
</h2>
<p>This section briefly describes a few of additional functions, with
additional detail provided in the help files for each of these
function.</p>
<ol style="list-style-type: decimal">
<li>The <code><a href="../reference/trim_osmdata.html">trim_osmdata()</a></code> function, as described above in the
sub-section on bounding boxes, trims an <code>osmdata</code> object to
within a defined bounding <em>polygon</em>, rather than bounding
box.</li>
<li>The <code><a href="../reference/opq_osm_id.html">opq_osm_id()</a></code> function allows queries for particular
OSM objects by their OSM-allocated ID values.</li>
<li>The <code><a href="../reference/osm_poly2line.html">osm_poly2line()</a></code> function converts all
<code>$osm_polygons</code> items of an <code>osmdata</code> object to
<code>$osm_lines</code>. These objects remain polygonal in form, through
sharing identical start and end points, but can then be treated as
simple lines. This is important for polygonal highways, which are
automatically classified as <code>$osm_polygons</code> simply because
they form closed loops. The function enables all highways to be grouped
together (as <code>$osm_lines</code>) regardless of the form.</li>
<li>The <code><a href="../reference/unique_osmdata.html">unique_osmdata()</a></code> function removes redundant items
from the different components of an <code>osmdata</code> object. A
multilinestring, for example, is composed of multiple lines, and each
line is composed of multiple points. For a multilinestring, an
<code>osmdata</code> object will thus contain several
<code>$osm_lines</code>, and for each of these several
<code>$osm_points</code>. This function removes all of these redundant
objects, so that <code>$osm_lines</code> only contains lines which are
not part of any higher-level objects, and <code>$osm_points</code> only
contains points which are not part of any higher-level objects.</li>
</ol>
<p>A further additional function is the ability to extract data as
represented in the OSM database prior to a specified date, or within a
specified range of dates. This is achieved by passing one or both values
to the <a href="https://docs.ropensci.org/osmdata/reference/opq.html"><code>opq()</code>
function</a> of <code>datetime</code> and <code>datetime2</code>. The
resultant data extracted with one or more <code><a href="../reference/add_osm_feature.html">add_osm_feature()</a></code>
calls and an extraction function (<code>osmdata_sf/sp/sc/xml</code>)
will then contain only those data present prior to the specified date
(when <code>datetime</code> only given), or between the two specified
dates (when both <code>datetime</code> and <code>datetime2</code>
given).</p>
</div>
<div class="section level2">
<h2 id="related-packages">6. Related Packages<a class="anchor" aria-label="anchor" href="#related-packages"></a>
</h2>
<p><span class="citation">Eugster and Schlesinger (2012)</span> describe
<code>osmar</code>, an R package for handling OSM data that enables
visualisation, search and even rudimentary routing operations.
<code>osmar</code> is not user friendly or able to download OSM data
flexibly, as reported in an <a href="https://eprints.whiterose.ac.uk/77643/" class="external-link">early tutorial</a>
comparing R and QGIS for handling OSM data <span class="citation">(Lovelace 2014)</span>. Note also that the
<code>osmar</code> package does not work at present, and can not be used
for accessing OSM data.</p>
<p><code>osmdata</code> builds on two previous R packages:
<code>osmplotr</code>, a package <a href="https://cran.r-project.org/package=osmplotr" class="external-link">available from
CRAN</a> for accessing and plotting OSM data <span class="citation">(Padgham 2016)</span> and <code>overpass</code>, a <a href="https://github.com/hrbrmstr/overpass" class="external-link">GitHub package</a> by Bob
Rudis that provides an R interface to the <a href="https://overpass-api.de/" class="external-link">overpass</a> API.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">7. References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-eugster_osmar:_2012" class="csl-entry">
Eugster, Manuel J a, and Thomas Schlesinger. 2012. <span>“Osmar:
<span>OpenStreetMap</span> and <span>R</span>.”</span> <em>The R
Journal</em> 5 (1): 53–64.
</div>
<div id="ref-johnson_models_2017" class="csl-entry">
Johnson, Peter A. 2017. <span>“Models of Direct Editing of Government
Spatial Data: Challenges and Constraints to the Acceptance of
Contributed Data.”</span> <em>Cartography and Geographic Information
Science</em> 44 (2): 128–38. <a href="https://doi.org/10.1080/15230406.2016.1176536" class="external-link">https://doi.org/10.1080/15230406.2016.1176536</a>.
</div>
<div id="ref-lovelace_harnessing_2014" class="csl-entry">
Lovelace, Robin. 2014. <span>“Harnessing Open Street Map Data with
<span>R</span> and <span>QGIS</span>.”</span> <em>EloGeo</em>.
</div>
<div id="ref-OpenStreetMap" class="csl-entry">
OpenStreetMap contributors. 2017. <span>“<span class="nocase">Planet
dump retrieved from https://planet.osm.org </span>.”</span> <a href="https://www.openstreetmap.org" class="external-link uri">https://www.openstreetmap.org</a>.
</div>
<div id="ref-osmplotr" class="csl-entry">
Padgham, Mark. 2016. <em>Osmplotr: Customisable Images of OpenStreetMap
Data</em>. <a href="https://cran.r-project.org/package=osmplotr" class="external-link">https://cran.r-project.org/package=osmplotr</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
